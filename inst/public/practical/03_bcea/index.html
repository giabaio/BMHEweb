<!DOCTYPE html><html lang="en-us" >


<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  
  
    <meta name="generator" content="Wowchemy 5.3.0 for Hugo" />
  

  
  









  




  
  
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  

  
  
  
    
      
      <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&family=Inconsolata:wght@400;500;600;700&display=swap&display=swap">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&family=Inconsolata:wght@400;500;600;700&display=swap&display=swap" media="print" onload="this.media='all'">
    
  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Gianluca Baio" />

  
  
  
    
  
  <meta name="description" content="Website for Bayesian methods in health economics" />

  
  <link rel="alternate" hreflang="en-us" href="/practical/03_bcea/" />

  
  
  
    <meta name="theme-color" content="#1565c0" />
  

  
  
    
    <script src="/js/mathjax-config.js"></script>
  

  

  <link rel="stylesheet" href="/css/vendor-bundle.min.f1ecf783c14edc00c9320c205831ad8e.css" media="print" onload="this.media='all'">

  
  
  
    
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.1/css/academicons.min.css" integrity="sha512-b1ASx0WHgVFL5ZQhTgiPWX+68KjS38Jk87jg7pe+qC7q9YkEtFq0z7xCglv7qGIs/68d3mAp+StfC8WKC5SSAg==" crossorigin="anonymous" media="print" onload="this.media='all'">
    

    
    
    
    
      
      
    
    
    

    
    
    
      
    
    
      
      
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/github.min.css" crossorigin="anonymous" title="hl-light" media="print" onload="this.media='all'">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/github.min.css" crossorigin="anonymous" title="hl-dark" media="print" onload="this.media='all'" disabled>
      
    

    
    
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.min.css" integrity="sha512-1xoFisiGdy9nvho8EgXuXvnpR5GAMSjFwp40gSRE3NwdUdIMIKuPa7bqoUhLD0O/5tPNhteAsE5XyyMi5reQVA==" crossorigin="anonymous" media="print" onload="this.media='all'">
    

    

    
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
    
      
      

      
      

      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js" integrity="" crossorigin="anonymous" async></script>
      
    
      
      

      
      

      
    
      
      

      
      

      
    
  

  
  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.3ef10ad94e43ba7ad3f08b0b007578ae.css" />

  



  

  

  




  
  
  

  
    <link rel="alternate" href="/practical/03_bcea/index.xml" type="application/rss+xml" title="Bayesian methods in health economics" />
  

  
    <link rel="manifest" href="/manifest.webmanifest" />
  

  <link rel="icon" type="image/png" href="/media/icon_hu62751289ff52b250e581ec75f909b74a_9702_32x32_fill_lanczos_center_3.png" />
  <link rel="apple-touch-icon" type="image/png" href="/media/icon_hu62751289ff52b250e581ec75f909b74a_9702_180x180_fill_lanczos_center_3.png" />

  <link rel="canonical" href="/practical/03_bcea/" />

  
  
  
  
  
  
  
  
    
    
  
  

  
  
    
    
  
  <meta property="twitter:card" content="summary" />
  
  <meta property="og:site_name" content="Bayesian methods in health economics" />
  <meta property="og:url" content="/practical/03_bcea/" />
  <meta property="og:title" content="Practical 3. Introduction to R and cost-effectiveness analysis using BCEA | Bayesian methods in health economics" />
  <meta property="og:description" content="Website for Bayesian methods in health economics" /><meta property="og:image" content="/media/logo_hu1963fc62d5b8fe503cce6274f5cb00c3_9765_300x300_fit_lanczos_3.png" />
    <meta property="twitter:image" content="/media/logo_hu1963fc62d5b8fe503cce6274f5cb00c3_9765_300x300_fit_lanczos_3.png" /><meta property="og:locale" content="en-us" />
  
    
      <meta property="og:updated_time" content="2022-06-20T16:30:00&#43;00:00" />
    
  

  



  

  





  <title>Practical 3. Introduction to R and cost-effectiveness analysis using BCEA | Bayesian methods in health economics</title>
</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class="page-wrapper   " data-wc-page-id="b9f309820c78d2a9b2d10c0bdb91e661" >

  
  
  
  
  
  
  
  
  
  <script src="/js/wowchemy-init.min.da42964e270e05a6063fbca894d7ccff.js"></script>

  




  <div class="page-header">
    











  


<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container-xl">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="/"><img src="/media/logo_hu1963fc62d5b8fe503cce6274f5cb00c3_9765_0x70_resize_lanczos_3.png" alt="Bayesian methods in health economics"
          
          ></a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar-content" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="/"><img src="/media/logo_hu1963fc62d5b8fe503cce6274f5cb00c3_9765_0x70_resize_lanczos_3.png" alt="Bayesian methods in health economics"
        
        ></a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-end" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
            
            
            
            
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#timetable"><span>Timetable</span></a>
        </li>

        
        

        
        <li class="nav-item dropdown">
          <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"><span>Slides</span><span class="caret"></span>
          </a>
          <div class="dropdown-menu">
            
              <a class="dropdown-item" href="/slides/01_Intro"><span>Introduction</span></a>
            
              <a class="dropdown-item" href="/slides/02_MCMC"><span>Bayesian computation</span></a>
            
              <a class="dropdown-item" href="/slides/03_Intro_HE"><span>Introduction to Health Economics</span></a>
            
              <a class="dropdown-item" href="/slides/04_ILD"><span>Individual level data</span></a>
            
              <a class="dropdown-item" href="/slides/05_ALD"><span>Aggregated level data</span></a>
            
              <a class="dropdown-item" href="/slides/06_NMA"><span>Network meta-analysis</span></a>
            
              <a class="dropdown-item" href="/slides/07_Model_uncertainty"><span>Model error and structural analysis</span></a>
            
              <a class="dropdown-item" href="/slides/08_Survival"><span>Survival modelling in HTA</span></a>
            
              <a class="dropdown-item" href="/slides/09_MM"><span>Markov models</span></a>
            
              <a class="dropdown-item" href="/slides/10_Missing"><span>Missing data in HTA</span></a>
            
              <a class="dropdown-item" href="/slides/11_VoI"><span>Introduction to Value of information</span></a>
            
              <a class="dropdown-item" href="/slides/12_EVPPI"><span>Expected value of partial information</span></a>
            
              <a class="dropdown-item" href="/slides/13_EVSI"><span>Expected value of sample information</span></a>
            
              <a class="dropdown-item" href="/syllabus/lecture14/14_Data_EVSI.pdf"><span>Generating data for the analysis of the EVSI</span></a>
            
              <a class="dropdown-item" href="/syllabus/lecture15/15_EVSI_MC.pdf"><span>Calculating expected value of sample information</span></a>
            
              <a class="dropdown-item" href="/syllabus/lecture16/16_EVSI_regression.pdf"><span>Regression-based EVSI</span></a>
            
          </div>
        </li>

        
        

        
        <li class="nav-item dropdown">
          <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"><span>Practicals</span><span class="caret"></span>
          </a>
          <div class="dropdown-menu">
            
              <a class="dropdown-item" href="/practical/01_monte-carlo"><span>Monte Carlo</span></a>
            
              <a class="dropdown-item" href="/practical/02_mcmc"><span>MCMC</span></a>
            
              <a class="dropdown-item" href="/practical/03_bcea"><span>Cost-effectiveness analysis</span></a>
            
              <a class="dropdown-item" href="/practical/04_ild"><span>HTA with individual level data</span></a>
            
              <a class="dropdown-item" href="/practical/05_ald"><span>Evidence synthesis and decision models</span></a>
            
              <a class="dropdown-item" href="/practical/06_nma"><span>NMA</span></a>
            
              <a class="dropdown-item" href="/practical/07_structural"><span>PSA to structural uncertainty</span></a>
            
              <a class="dropdown-item" href="/practical/08_survival"><span>Survival analysis</span></a>
            
              <a class="dropdown-item" href="/practical/09_mm"><span>Markov and multistate models</span></a>
            
              <a class="dropdown-item" href="/practical/10_missing"><span>Missing data</span></a>
            
              <a class="dropdown-item" href="/practical/11_intro_voi"><span>Computing the EVPI using Monte Carlo</span></a>
            
              <a class="dropdown-item" href="/practical/12_evppi"><span>Computing the EVPPI in BCEA and SAVI</span></a>
            
              <a class="dropdown-item" href="/practical/13_data_evsi"><span>Generating data for the EVSI</span></a>
            
              <a class="dropdown-item" href="/practical/14_evsi_mc"><span>Computing the EVSI using Monte Carlo</span></a>
            
              <a class="dropdown-item" href="/practical/15_evsi_regression"><span>Computing the EVSI using regression</span></a>
            
          </div>
        </li>

        
        

        
        <li class="nav-item dropdown">
          <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"><span>Instructions</span><span class="caret"></span>
          </a>
          <div class="dropdown-menu">
            
              <a class="dropdown-item" href="/tips/computer-specification"><span>Computer specification</span></a>
            
              <a class="dropdown-item" href="/tips/using-bugs"><span>Using BUGS</span></a>
            
          </div>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/publication"><span>Reading list</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
            
            
            
            
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#people"><span>People</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">

      
      
        
      
        
      
        
      
        
      

      
      

      
      

      
      

    </ul>

  </div>
</nav>


  </div>

  <div class="page-body">
    

<div class="container-fluid docs">
  <div class="row flex-xl-nowrap">
    <div class="col-12 col-md-3 col-xl-2 docs-sidebar">
      <form class="docs-search d-flex align-items-center">
  <button class="btn docs-toggle d-md-none p-0 mr-md-3 w-100" type="button" data-toggle="collapse" data-target="#docs-nav" aria-controls="docs-nav" aria-expanded="false" aria-label="Toggle section navigation">
    <div class="d-flex">
      <span class="d-md-none pl-1 flex-grow-1 text-left overflow-hidden">
        
          
        
      </span>
      <span><i class="fas fa-chevron-down"></i></span>
    </div>
  </button>

  
</form>

<nav class="collapse docs-links" id="docs-nav">
  
  
  
  
  
  

  
  
    

    
      

      


  
    
    
    
    
      
    
    

    
      <ul class="nav docs-sidenav">
        <li class=""><a href="/practical/"></a></li>
    
      


  
    
    
    
    
      
    
    

    
      <div class="docs-toc-item">
        <a class="docs-toc-link " href="/practical/01_monte-carlo/">1. Monte Carlo</a>
    
      
        <ul class="nav docs-sidenav">
      


  <li class=""><a href="/practical/01_monte-carlo/solutions/">Solutions</a></li>

      
        </ul>
      
    

    
      </div>
    



  
    
    
    
    
      
    
    

    
      <div class="docs-toc-item">
        <a class="docs-toc-link " href="/practical/02_mcmc/">2. MCMC</a>
    
      
        <ul class="nav docs-sidenav">
      


  <li class=""><a href="/practical/02_mcmc/solutions/">Solutions</a></li>



  <li class=""><a href="/practical/02_mcmc/covid/">Covid</a></li>



  <li class=""><a href="/practical/02_mcmc/tutorial/">MCMC Tutorial</a></li>

      
        </ul>
      
    

    
      </div>
    



  
    
    
    
    
      
    
    

    
      <div class="docs-toc-item">
        <a class="docs-toc-link  active" href="/practical/03_bcea/">3. Intro-HE</a>
    
      
        <ul class="nav docs-sidenav">
      


  <li class=""><a href="/practical/03_bcea/solutions/">Solution</a></li>

      
        </ul>
      
    

    
      </div>
    



  
    
    
    
    
      
    
    

    
      <div class="docs-toc-item">
        <a class="docs-toc-link " href="/practical/04_ild/">4. ILD</a>
    
      
        <ul class="nav docs-sidenav">
      


  <li class=""><a href="/practical/04_ild/tutorial-regression/">Regression Tutorial</a></li>



  <li class=""><a href="/practical/04_ild/solutions/">Solutions</a></li>

      
        </ul>
      
    

    
      </div>
    



  
    
    
    
    
      
    
    

    
      <div class="docs-toc-item">
        <a class="docs-toc-link " href="/practical/05_ald/">5. ALD</a>
    
      
        <ul class="nav docs-sidenav">
      


  <li class=""><a href="/practical/05_ald/solutions/">Solutions</a></li>

      
        </ul>
      
    

    
      </div>
    



  
    
    
    
    
      
    
    

    
      <div class="docs-toc-item">
        <a class="docs-toc-link " href="/practical/06_nma/">6. NMA</a>
    
      
        <ul class="nav docs-sidenav">
      


  <li class=""><a href="/practical/06_nma/solutions/">Solutions</a></li>

      
        </ul>
      
    

    
      </div>
    



  
    
    
    
    
      
    
    

    
      <div class="docs-toc-item">
        <a class="docs-toc-link " href="/practical/07_structural/">7. PSA to structural uncertainty</a>
    
      
        <ul class="nav docs-sidenav">
      


  <li class=""><a href="/practical/07_structural/solutions/">Solutions</a></li>

      
        </ul>
      
    

    
      </div>
    



  
    
    
    
    
      
    
    

    
      <div class="docs-toc-item">
        <a class="docs-toc-link " href="/practical/08_survival/">8. Survival</a>
    
      
        <ul class="nav docs-sidenav">
      


  <li class=""><a href="/practical/08_survival/solutions/">Solutions</a></li>

      
        </ul>
      
    

    
      </div>
    



  
    
    
    
    
      
    
    

    
      <div class="docs-toc-item">
        <a class="docs-toc-link " href="/practical/09_mm/">9. Markov models</a>
    
      
        <ul class="nav docs-sidenav">
      


  <li class=""><a href="/practical/09_mm/solutions/">Solutions</a></li>



  <li class=""><a href="/practical/09_mm/cohort-model/">Cohort discrete Markov model</a></li>

      
        </ul>
      
    

    
      </div>
    



  
    
    
    
    
      
    
    

    
      <div class="docs-toc-item">
        <a class="docs-toc-link " href="/practical/10_missing/">10. Missing data</a>
    
      
        <ul class="nav docs-sidenav">
      


  <li class=""><a href="/practical/10_missing/solutions/">Solutions</a></li>

      
        </ul>
      
    

    
      </div>
    



  
    
    
    
    
      
    
    

    
      <div class="docs-toc-item">
        <a class="docs-toc-link " href="/practical/11_intro_voi/">11. EVPI using MC</a>
    

    
      </div>
    



  
    
    
    
    
      
    
    

    
      <div class="docs-toc-item">
        <a class="docs-toc-link " href="/practical/12_evppi/">12. EVPPI in BCEA &amp; SAVI</a>
    

    
      </div>
    



  
    
    
    
    
      
    
    

    
      <div class="docs-toc-item">
        <a class="docs-toc-link " href="/practical/13_data_evsi/">13 Generating data for EVSI</a>
    

    
      </div>
    



  
    
    
    
    
      
    
    

    
      <div class="docs-toc-item">
        <a class="docs-toc-link " href="/practical/14_evsi_mc/">14. EVSI using MC</a>
    

    
      </div>
    



  
    
    
    
    
      
    
    

    
      <div class="docs-toc-item">
        <a class="docs-toc-link " href="/practical/15_evsi_regression/">15. EVSI using regression</a>
    

    
      </div>
    

      
    

    
      </ul>
    

  
</nav>
    </div>

    <main class="col-10 docs-content" role="main">
      <article class="article">

        <div class="docs-article-container">
          <h1>Practical 3. Introduction to R and cost-effectiveness analysis using BCEA</h1>
          
          <p style="color:grey;"><i>Monday, 20 June 2022</i></p>
          
          
          




<div class="btn-links mb-3">
  
  








  


















  
  
  
    
  
  
  
  
  
    
    
      
    
  
  <a class="btn btn-outline-primary btn-page-header" href="/slides/03_Intro_HE" >
    Lecture 3</a>

  
  
  
    
  
  
  
  
  
    
    
      
    
  
  <a class="btn btn-outline-primary btn-page-header" href="/practical/03_bcea/practical3.pdf" >
    <i class="fas fa-file-pdf mr-1"></i>PDF version</a>


</div>


          <br>
          
          <div class="article-style">
            


<p>This is a very brief introduction to <tt>R</tt> (which
can be downloaded from the website <a href="https://cran.r-project.org/" class="uri">https://cran.r-project.org/</a>) and
its capabilities. <tt>R</tt> is available on the UCL
Desktops and you can actually use the
<tt>R</tt> frontend software called <tt>Rstudio</tt>. You do
not <em>have</em> to use <tt>Rstudio</tt> and in fact, the standard
<tt>R</tt> terminal would do just as well. However,
<tt>Rstudio</tt> has some nice features and it is a better text editor/file
manager, so it is probably a good idea to start using it. It will be
extremely focussed on the characteristics that are instrumental to do
health economic evaluations using a combination of
<tt>R</tt>, <tt>BUGS</tt> and some
useful packages (such as <a href="https://gianluca.statistica.it/software/bcea/"><tt>BCEA</tt></a>). Thus it is
by no means exhaustive!</p>
<div id="ridiculously-short-and-incomplete-introduction-to-r" class="section level2">
<h2>(Ridiculously short and incomplete) Introduction to <tt>R</tt></h2>
<p>When you open the <tt>R</tt> terminal, you are
presented with the possibility of typing commands. You may want to open
a text editor (e.g. the simple one built into the R Windows interface)
in which you can type directly these commands, and save them to a script
for future use. Another possibility is to use
<tt>R</tt> from within a more sophisticated
“integrated development environment”, such as <a href="www.rstudio.com"><tt>Rstudio</tt></a>, which has many more features than the basic Windows
interface.</p>
<p>In any case, <tt>R</tt> is a very powerful tool; more
importantly, it is free and you can find a wealth of documentation on
the internet. <tt>R</tt> has a set of built-in
commands, which you can use for basic operations. However, there are
also many add-on packages containing sets of functions designed to
perform specific statistical tasks. These packages can be installed to
<em>your</em> <tt>R</tt> by typing the command</p>
<pre><code> install.packages(&quot;package_name&quot;)</code></pre>
<p>(assuming you have an internet connection). This command only needs to
be executed one time. Once a package is installed in your local
<code>library</code> (a collection of packages) you can make it available to the
current <tt>R</tt> session by typing the command</p>
<pre><code> library(package_name)</code></pre>
<p>For these practicals, you will need to install and load the packages:</p>
<ul>
<li><p><tt>BCEA</tt>, which can be used to post-process
the results of a (Bayesian) model to perform a health
economic evaluation.</p></li>
<li><p><tt>R2OpenBUGS</tt>, which can be used to interface
<tt>R</tt> and <tt>BUGS</tt> .</p></li>
</ul>
<p>You do this by typing in your <tt>R</tt> terminal the
commands</p>
<pre><code>install.packages(&quot;BCEA&quot;)
install.packages(&quot;R2OpenBUGS&quot;)
library(BCEA)
library(R2OpenBUGS)</code></pre>
<p>Both <tt>BCEA</tt>and <tt>R2OpenBUGS</tt> will automatically
load other packages that they <em>depend on</em> — this means that in order to
work, they need to access functions that are part of other packages.</p>
<p>If you wish so, you can use <tt>JAGS</tt> in the practicals. To this end (and
assuming you have actually installed the current version of <tt>JAGS</tt> to
your computer), you will need to also install the package <tt>R2jagsS</tt>,
which you can do by typing in your <tt>R</tt> terminal</p>
<pre><code>install.packages(&quot;R2jags&quot;)</code></pre>
<p>Notice that if you decide to use <tt>JAGS</tt> instead
of <tt>BUGS</tt>, you will need to slightly modify
some of the commands.</p>
<p>Once a package is loaded to your <tt>R</tt> workspace,
you can type the command <code>help(package_name)</code>, which will open a window
displaying a description of the package. For example <code>help(BCEA)</code>
provides some basic information (including details of the current
version). You can use the command <code>help</code> also on specific functions
within the package, e.g. typing <code>help(bcea)</code> describes in detail how to
use the <code>bcea</code> function (notice that in this case the package name is
typeset in uppercase, while the function is lowercase!).</p>
<p>The very basic commands that are required to do a typical
<tt>R</tt> session working with
<tt>BUGS</tt> and <tt>BCEA</tt>will
be given and described later or in the scripts that we refer to in the
practicals.</p>
</div>
<div id="MCMC_R_BUGS" class="section level2">
<h2>MCMC in <tt>R</tt>/<tt>BUGS</tt></h2>
<p>Consider Laplace’s analysis of birth data, which included <span class="math inline">\(y=241\,945\)</span>
females out of <span class="math inline">\(n=493\,527\)</span> babies born in Paris between 1745 and 1770.
Assume the following modelling assumptions:
<span class="math display">\[\begin{aligned}
y &amp; \sim \mbox{Binomial}(\theta,n)\\
\theta &amp; \sim \mbox{Uniform}(0,1).\end{aligned}\]</span></p>
<ol style="list-style-type: decimal">
<li><p>Write <tt>BUGS</tt> code to encode the modelling
assumptions above and save it to a <code>.txt</code> file (you can choose
whatever name and location you want. We assume you’ve chosen
<code>ModelLaplace.txt</code>, which you have saved in the current directory).</p></li>
<li><p>Open <tt>R</tt> , which will be used to
pre-process the data, call <tt>BUGS</tt> in
background to perform the MCMC estimation and then post-process
the results. At the terminal, type the following commands</p>
<pre><code>y &lt;- 241945
n &lt;- 493527
data &lt;- list(y=y,n=n)</code></pre>
<p>This defines the variables <code>y</code> and <code>n</code> into the
<tt>R</tt> workspace and create a <code>list</code> (named
<code>data</code>), which contains them.</p>
<p><div class="alert alert-note">
  <div>
    (Notice that in <tt>R</tt> you can use the notation “<code>&lt;-</code>” to indicate assignment to a variable, as well as the more straightforward notation “<code>=</code>”. Thus the commands <code>a &lt;- b</code> and <code>c = b</code> create two variables <code>a</code> and <code>c</code> which both take the value associated with the variable <code>b</code> — irrespective of the sign used to define the assignment operator). Technically (and at the level of the data stored in the computer memory) the two statements are not identical, but for all intent and purposes, they are.
  </div>
</div>
<br />
Now, set up some utility variables, such as the location of the
<tt>BUGS</tt> model file, the parameters to be
monitored and the initial values, by typing</p>
<pre><code>filein &lt;- &quot;PATH_TO_FILE/NAME_OF_FILE.txt&quot;
params &lt;- &quot;theta&quot;
inits_det &lt;- list(list(theta=.1),list(theta=.9))
inits_ran &lt;- function(){list(theta=runif(1))}</code></pre>
<p>The <tt>R</tt> workspace now contains a variable
<code>filein</code> (a text string with the path to your model file,
e.g. <code>C:/bayes-hecourse/4_bcea/ModelLaplace.txt</code>); a variable
<code>params</code> (another text string containing the name of the variable
you want to monitor); the two variables <code>inits_det</code> and <code>inits_ran</code>
can be used to instruct <tt>BUGS</tt> which
initial values to use. The former is a <code>list</code> containing two initial
values for the node <code>theta</code> (they are arbitrarily set to 0.1 and
0.9, so that two chains can be run, starting from different points).
The latter is an <tt>R</tt> <code>function</code>, which
creates a list with a variable <code>theta</code>, which is assigned a random
draw from a Uniform(0, 1) distribution.</p></li>
<li><p>Call <tt>BUGS</tt> from within
<tt>R</tt> by using the following commands</p>
<pre><code>model &lt;- bugs(data=data,inits=inits_det,
          parameters.to.save=params,model.file=filein,
          n.chains=2,n.iter=10000,n.burnin=4500,
          n.thin=1,DIC=TRUE)</code></pre>
<p>— notice that you can either use the syntax <code>inits=inits_det</code> or
<code>inits=inits_ran</code>. <tt>BUGS</tt> is called in
background and executes the MCMC analysis. When it has completed
(which should be extremely quick in this simple case), you will
regain use of the <tt>R</tt> terminal.</p>
<p>The <tt>R</tt> object <code>model</code> contains many
variables; typing</p>
<pre><code>names(model)</code></pre>
<p>will print a list of them. Each can be accessed using the
<tt>R</tt> “<code>$</code>” notation. For example, typing</p>
<pre><code>model$n.iter</code></pre>
<p>will print the number of iterations used by
<tt>BUGS</tt> .</p></li>
<li><p>Check the results by using the command</p>
<pre><code>print(model,digits=3,intervals=c(0.025,0.975))</code></pre>
<p>This instructs <tt>R</tt> to give a tabular output
reporting summary statistics (specifically reporting the 2.5% and
97.5% percentiles) from the posterior distribution(s) of the node(s)
monitored, using 3 significant digits.</p>
<p>What can you say about convergence by just looking at the resulting
tabular display that <tt>R</tt> will provide?</p></li>
<li><p>Attach the MCMC simulations to the
<tt>R</tt> workspace by typing</p>
<pre><code>attach.bugs(model)</code></pre>
<p>This makes all the elements of the object <code>model</code> available in your
<tt>R</tt> session.</p>
<p>Plot a histogram of the posterior distribution for <code>theta</code> by typing</p>
<pre><code>hist(theta)</code></pre>
<p>What can you say about the underlying probability of a female birth?</p></li>
</ol>
</div>
<div id="mcmc-in-rjags" class="section level2">
<h2>MCMC in <tt>R</tt>/<tt>JAGS</tt></h2>
<p>If you want to use <tt>JAGS</tt> instead of
<tt>BUGS</tt>, there are not many difference with
respect to the previous code/analysis. You can use these guidelines to
perform the analyses in the practicals using
<tt>JAGS</tt> .</p>
<p>The first thing to do is to load the package <tt>R2jags</tt>, which you do by
typing in your <tt>R</tt> terminal the command
<code>library(R2jags)</code>. You can now replicate steps 1. and 2. from the
previous section to write your model and prepare the data and relevant
variables. Notice, however, that while most of the time the
<tt>BUGS</tt> code will apply with no problems to
<tt>JAGS</tt>, there are a few differences that may
prevent your model code from working. One such example is the way in
which <tt>BUGS</tt> and
<tt>JAGS</tt> manage truncation and censoring (see,
for instance page 205 of BMHE).</p>
<p>The first change is that (unsurprisingly!) you need to call the function
<code>jags</code>, instead of the function <code>bugs</code>. Thus, point 3. above becomes</p>
<pre><code>model2 &lt;- jags(data=data,inits=inits_det,
          parameters.to.save=params,model.file=filein,
          n.chains=2,n.iter=10000,n.burnin=4500,
          n.thin=1,DIC=TRUE)</code></pre>
<p>This time, <tt>JAGS</tt> is called in background and
performs the MCMC estimation. By default, <tt>R2jags</tt> shows a text bar with
the progression through the required simulations; a running series of
asterisks is printed and the counter is incremented while the iterations
are generated.</p>
<p>The second and perhaps most important difference is in the nature of the
objects created. If you type in your
<tt>R</tt> terminal the command <code>names(model2)</code>,
<tt>R</tt> will show you the names of the elements of
the object <code>model2</code></p>
<pre><code>[1] &quot;model&quot;              &quot;BUGSoutput&quot;         &quot;parameters.to.save&quot;
[4] &quot;model.file&quot;         &quot;n.iter&quot;             &quot;DIC&quot;   </code></pre>
<p>You can access each of these elements using the syntax <code>object$element</code>,
so for example <tt>R</tt> will respond to the command
<code>model2$n.iter</code> by printing the value for the number of iterations that
have been used (in this case 10000).</p>
<p>If, for instance, you had run the steps described in the previous
section and had produced the <tt>BUGS</tt> object
<code>model</code>, <tt>R</tt> reponse to a command
<code>names(model)</code> would show different elements. In fact, the difference is
that <tt>JAGS</tt> stores <em>these</em> elements in the
object <code>model2$BUGSoutput</code>; thus typing <code>names(model2$BUGSOutput)</code> gives
the following output</p>
<pre><code>[1] &quot;n.chains&quot;        &quot;n.iter&quot;          &quot;n.burnin&quot;        &quot;n.thin&quot;         
[5] &quot;n.keep&quot;          &quot;n.sims&quot;          &quot;sims.array&quot;      &quot;sims.list&quot;      
[9] &quot;sims.matrix&quot;     &quot;summary&quot;         &quot;mean&quot;            &quot;sd&quot;             
[13] &quot;median&quot;          &quot;root.short&quot;      &quot;long.short&quot;      &quot;dimension.short&quot;
[17] &quot;indexes.short&quot;   &quot;last.values&quot;     &quot;program&quot;         &quot;model.file&quot;     
[21] &quot;isDIC&quot;           &quot;DICbyR&quot;          &quot;pD&quot;              &quot;DIC&quot;       </code></pre>
<p>which is basically the same as that produced by a call to
<tt>BUGS</tt> .</p>
<p>The third basic difference is that if you want to make the results of
your simulations available to the
<tt>R</tt> workspace, you need to use the command
<code>attach.jags(model2)</code> (or whatever the name of the object created with
the call to the <tt>JAGS</tt> function).</p>
</div>
<div id="flu" class="section level2">
<h2>Health economic evaluation in <tt>R</tt> using <tt>BCEA</tt></h2>
<p>Suppose the interest is in an infectious disease, e.g. influenza, for
which a new vaccine has been produced. Under the current management of
the disease some individuals treat the infection by taking over the
counter (OTC) medications. Some subjects visit their GP and, depending
on the severity of the infection, may receive treatment with antiviral
drugs, which usually cures the infection. However, in some cases
complications may occur. Minor complications will need a second GP visit
after which the patients become more likely to receive antiviral
treatment. Major complications are represented by pneumonia and can
result in hospitalisation and possibly death. In this scenario, the
costs generated by the management of the disease are represented by OTC
medications, GP visits, the prescription of antiviral drugs, hospital
episodes and indirect costs such as time off work. QALYs are used as a
measure of clinical benefit. The focus is on the clinical and economic
evaluation of the policy that makes the vaccine available to those who
wish to use it (<span class="math inline">\(t=1\)</span>) against the null option (<span class="math inline">\(t=0\)</span>) under which the
vaccine will remain unavailable.</p>
<ul>
<li><p>The file <a href="Vaccine.RData"><code>Vaccine.RData</code></a> contains the results of a economic model,
which are saved in an object <code>he</code>.
<div class="alert alert-note">
  <div>
    <strong>NB</strong>: To download the file, right-click on the link and select “Save Link As…”
  </div>
</div>
</p>
<p>From your
<tt>R</tt> terminal, load the data and examine the
object <code>he</code> using the commands</p>
<pre><code>load(&quot;Vaccine.RData&quot;)
names(he)</code></pre>
<p>Load <tt>BCEA</tt>by typing the command</p>
<pre><code>library(BCEA)</code></pre>
<p>and compute the ICER using the elements <code>delta.e</code> and <code>delta.c</code>,
which are included in the object <code>he</code> and contain the simulations
from the posterior distributions of the variables
<span class="math inline">\((\Delta_e,\Delta_c)\)</span> (i.e. the effectiveness and cost differential,
respectively), obtained by running a suitable Bayesian model.
<div class="alert alert-note">
  <div>
    <strong><em>Hint</em></strong>: the command <code>a = b / c</code> instructs <tt>R</tt> to
compute a variable <code>a</code> defined as the ratio between the variables
<code>b</code> and <code>c</code>; similarly, the command <code>d = mean(e)</code> saves the mean of
the values contained in a vector <code>e</code> to a new variable <code>d</code>.
  </div>
</div>
<br />
</p></li>
<li><p>Assuming a fixed value of the willingness-to-pay threshold of
<span class="math inline">\(k=30\,000\)</span>, compute the value of the EIB.
<div class="alert alert-note">
  <div>
    <strong><em>Hint</em></strong>: consider the definition of EIB and use the values for <code>delta.e</code> and <code>delta.c</code>. In
<tt>R</tt> , the commands <code>a = b + c</code> and
<code>d = e - f</code> define variables <code>a</code> and <code>d</code> as the sum and the
difference of other variables, previously defined in the workspace.
  </div>
</div>
</p></li>
<li><p>In the <tt>R</tt> terminal, execute the command</p>
<pre><code>ceplane.plot(he)</code></pre>
<p>to produce the cost-effectiveness plane for the comparison of <span class="math inline">\(t=1\)</span>
vs <span class="math inline">\(t=0\)</span>, using a default value of <span class="math inline">\(k=25\,000\)</span>.</p>
<p>How can you interpret the resulting graph, in terms of economic
evaluation?</p></li>
<li><p>In the <tt>R</tt> terminal, execute the command</p>
<pre><code>ceplane.plot(he,wtp=10000)</code></pre>
<p>to produce the cost-effectiveness plane for the comparison of <span class="math inline">\(t=1\)</span>
vs <span class="math inline">\(t=0\)</span>, using a value of <span class="math inline">\(k=10\,000\)</span>.</p>
<p>How is the economic interpretation of the results modified, in
comparison to point c?</p></li>
<li><p>In the <tt>R</tt> terminal, execute the command</p>
<pre><code>eib.plot(he, plot.cri=FALSE)</code></pre>
<p>to obtain a graph showing the EIB as a function of
the willingness-to-pay. (Notice that you need to add the option
<code>plot.cri=FALSE</code>, which prevents <code>BCEA</code> from drawing a credible
interval around the EIB, in this particular case. The reason is that
the <code>BCEA</code> object <code>he</code> has been tampered with for the purpose of
running this exercise. In general, you do not need to specify the
option and by default <code>BCEA</code> will also show the credible interval).</p>
<p>How can you interpret this graph in terms of cost-effectiveness
analysis?</p></li>
<li><p>In the <tt>R</tt> terminal, execute the command</p>
<pre><code>contour(he)</code></pre>
<p>to produce the cost-effectiveness plane for the comparison of <span class="math inline">\(t=1\)</span>
vs <span class="math inline">\(t=0\)</span> together with a contour plot of the bivariate distribution
for <span class="math inline">\((\Delta_e,\Delta_c)\)</span>. The graph also reports the proportion of
simulated points in each quadrant.</p>
<p>Comment on the cost-effectiveness results. What is the probability
that vaccination (<span class="math inline">\(t=1\)</span>) is dominated by the status quo (<span class="math inline">\(t=0\)</span>)?</p></li>
</ul>
</div>

          </div>

          



          
          
          <div class="article-widget">
            
<div class="post-nav">
  
  
</div>

          </div>
          
        </div>

        <div class="body-footer">
          
          

          


          
          
          
          
          


          




          




        </div>

      </article>

      <footer class="site-footer">
  

  <p class="powered-by">
    
    
      &copy;  2022-2024 &middot;

    Based on
    <a href="https://wowchemy.com/?utm_campaign=poweredby" target="_blank" rel="noopener">Wowchemy</a>
    
    
    (version 5.3.0)
    
    for <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a> &middot;
    
    
    <i><b>Latest update: 24 Jun 2022 </i></b>
    

    
    <span class="float-right" aria-hidden="true">
      <a href="#" class="back-to-top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>

</footer>


    </main>
  </div>
</div>

  </div>

  <div class="page-footer">
    
    
  </div>

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

      

    
    <script src="/js/vendor-bundle.min.b73dfaac3b6499dc997741748a7c3fe2.js"></script>

    
    
    
      
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      

      
      

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/highlight.min.js" integrity="sha512-TDKKr+IvoqZnPzc3l35hdjpHD0m+b2EC2SrLEgKDRWpxf2rFCxemkgvJ5kfU48ip+Y+m2XVKyOCD85ybtlZDmw==" crossorigin="anonymous"></script>
        
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/r.min.js" crossorigin="anonymous"></script>
        
      

    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.min.js" integrity="sha512-SeiQaaDh73yrb56sTW/RgVdi/mMqNeM2oBwubFHagc5BkixSpP1fvqF47mKzPGWYSSy4RwbBunrJBQ4Co8fRWA==" crossorigin="anonymous"></script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.2.2/anchor.min.js" integrity="sha512-I7w3ZdSFzw5j3jU3ZkNikBNeIrl3i+hEuEdwNmqUJvwNcaBUNcijnP2gd9DtGlgVYDplfjGoD8vTNsID+lCjqg==" crossorigin="anonymous"></script>
    <script>
      anchors.add();
    </script>
    

    
    
    

    
    

    
    
    
    

    
    

    
    
    
    
    
    
    
    
    
    <script src="/en/js/wowchemy.min.50d3bf3df0c53b31631bb48a62b35f92.js"></script>

    






</body>
</html>
